{% extends "layout/sidebar.html" %}

{% import "forms/forms.html" as forms %}
{% import "forms/fields.html" as fields %}

{% block page_title %}Importer/Exporter Access Request{% endblock %}
{% block context_header %}Importer/Exporter Access Request{% endblock %}

{% block sidebar%}
    {% with process_id=activation.process.access_request.id, 
            task_id=activation.task.id 
    %}
        {% include "web/case-fir-sidebar.html" %}
    {% endwith %}
{% endblock %}

{% block main_content %}
    {% set process, task, access_request = activation.process, activation.task, activation.process.access_request %}
    <div class="info-box info-box-info">
        <p>The user specified below has requested access to act as an importer/agent. If you already know that this user should have these access rights you can
            simply add them to the appropriate importer/agent team (note - you may need to create the importer/agent entity first). Use the Link/Maintain link
            below.</p>
        <p>If on the other hand this is a new access request then you can request approval from the main importer using the form below. Note - you will need to
            link the importer on the access request to an importer within the ICMS system first.</p>
        <p>Once the Access Request has been actioned you should close the request using the Close section below. An email will be sent to the requester stating
            the outcome of their request.</p>
    </div>

    {% include "web/access-request/partials/access-request-display.html" %}

    <div class="container setoutForm" data-xfid="f57">
        <div class="row">
            <div class="twelve columns" data-xfid="f59">
                <div class="container setoutForm" data-xfid="f59">
                    {% if access_request.requester_type == 'importer' %}
                        <div class="row">
                            <div class="three columns"></div>
                            <div class="six columns" data-xfid="g63">
                              {{access_request.linked_importer}}
                              {% call forms.form(method='post', csrf_input=csrf_input) %}
                              <a href="{{url('link-importer', args=(process.id,task.id ))}}" value="link" type="submit"
                                        class="link-button inline-link-button button">
                                    Link / Maintain Importer
                                </a>
                              {% endcall %}
                            </div>
                            <div class="three columns"></div>
                        </div>
                    {% else %}
                        <div class="row">
                            <div class="three columns"></div>
                            <div class="six columns" data-xfid="g63">
                              {{access_request.linked_exporter}}
                              {% call forms.form(method='post', csrf_input=csrf_input) %}
                              <a href="{{url('link-exporter', args=(process.id, task.id))}}" type="button"
                                        class="link-button inline-link-button button">
                                    Link / Maintain Exporter
                                </a>
                              {% endcall %}
                            </div>
                            <div class="three columns"></div>
                        </div>
                    {% endif %}
                </div>
                <div class="row">
                    <div class="three columns"></div>
                    <div class="six columns" data-xfid="g67"></div>
                    <div class="three columns"></div>
                </div>
            </div>
            {% if activation.process.access_request.request_reason is none %}
                <h3>Exporter Access Approval</h3>
                <div class="info-box info-box-info">
                    You must first link an exporter to the access request if you wish to start exporter access approval. Please use Link / Maintain Exporter
                    above.
                </div>
            {% else %}
                <h3>Importer Access Approval</h3>
                <div class="info-box info-box-info">
                    You must first link an importer to the access request if you wish to start importer access approval. Please use Link / Maintain Importer
                    above.
                </div>
            {% endif %}

            <h3>
                Close Access Request
            </h3>

             <div class="info-box info-box-success">
                {% call forms.form(method='post', csrf_input=csrf_input) %}
                    <input type="hidden" name="_viewflow_activation-started" value="{{ form.datetime_now }}" id="id__viewflow_activation-started">
                    {{ fields.field(form.response)}}
                    <div class="hidden" id="response-reason-container">{{ fields.field(form.response_reason) }}</div>
                    <button type="submit" name="action" value="respond" />Close Access Request</button>
                {% endcall %}
            </div>
        </div>
    </div>

    <script src="{{ static('web/js/review-request-access.js') }}" type="text/javascript"></script>

{% endblock %}
