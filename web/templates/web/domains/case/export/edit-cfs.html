{% extends "flow/task-base.html" %}
{% import "forms/fields.html" as fields %}

{% block sidebar %}
  {% include "partial/case/export/cfs/sidebar.html" %}
{% endblock %}

{% block css %}
  {{ form.media.css }}
{% endblock %}

{% block page_js %}
  {{ form.media.js }}
{% endblock %}

{% block form_content %}
  <div class="info-box info-box-info">
    This form is in respect of the Exporting Company. Please provide all the
    information requested. The information will be used to create a Certificate
    of Free Sale and a legal declaration in the form of a Schedule.
  </div>

  {{ super() }}

  <h4>Contact</h4>
  {{ fields.field(form.contact) }}
  {# TODO: show contact telephone/email; do we need to reload the form on contact change...? #}

  <h4>Application details</h4>
  <p>TODO</p>
{% endblock %}

{% block task_actions %}
  <li>
    <button type="submit" role="action-button" name="close_request" class="primary-button button">
      Save
    </button>
  </li>
{% endblock %}

{% block subtasks %}

  <h4>Schedules</h4>
  <table class="setoutList">
    <thead>
    <tr>
      <th>Schedules</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    {% for schedule in schedules %}
      <tr>
        {# TODO: Replace with a count e.g. Schedule (2/4) #}
        <td>Schedule ({{ schedule.pk }})</td>
        <td>
          <a
            class="link-button button icon-pencil" data-input_action="edit"
            href="{{ icms_url('export:cfs-schedule-edit', kwargs={'application_pk': process.pk, 'schedule_pk': schedule.pk}) }}"
          >Edit</a>
          <form
            method="post"
            action="{{ icms_url('export:cfs-schedule-delete', kwargs={'application_pk': process.pk, 'schedule_pk': schedule.pk}) }}"
            class="form-inline">
            {{ csrf_input }}
            <button
              type="submit"
              class="link-button icon-bin button tooltipstered"
              aria-label="Delete"
              data-confirm="Are you sure you want to delete this record?">Delete
            </button>
          </form>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  <hr>
  <form
    method="post"
    action="{{ icms_url('export:cfs-schedule-add', kwargs={'application_pk': process.pk}) }}"
    class="form-inline">
    {{ csrf_input }}
    <button
      type="submit"
      class="button small-button icon-plus"
      >Add Schedule
    </button>
  </form>
{% endblock %}
