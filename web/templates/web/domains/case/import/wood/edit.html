{% extends "flow/task-base.html" %}
 {% import "forms/forms.html" as forms %}
 {% import "forms/fields.html" as fields %}

 {% block sidebar %}
     {% include "partial/case/import/wood/sidebar.html" %}
 {% endblock %}

 {% block main_content %}
   {% block task_details %}
     {{ super() }}
   {% endblock %}

   {% call forms.form(action='', method='post', csrf_input=csrf_input) -%}
     <h4>Contact</h4>
     {{ fields.field(form.contact) }}

     <h4>Wood (Quota)</h4>
     {{ fields.field(form.applicant_reference) }}
     {{ fields.field(form.shipping_year) }}

     <h4>Exporter details</h4>
     {{ fields.field(form.exporter_name) }}
     {{ fields.field(form.exporter_address) }}
     {{ fields.field(form.exporter_vat_nr) }}

     <h4>Goods</h4>
     {{ fields.field(form.commodity_code) }}
     {{ fields.field(form.goods_description) }}
     {{ fields.field(form.goods_qty) }}
     {{ fields.field(form.goods_unit) }}

     <h4>Misc</h4>
     {{ fields.field(form.additional_comments) }}

     <input type="submit" name="action" class="primary-button button" value="Save" />
  {% endcall %}

   <h4>Contract/pre-contract</h4>
   <p>Please fill in the details of all relevant contracts or pre-contracts
   between the importer and exporter, and upload the contract/pre-contract,
   below.</p>

   {% if contract_documents %}
     <table class="setoutList">
       <thead>
         <tr>
           <th>Reference No.</th>
           <th>Date</th>
           <th>Uploaded by</th>
           <th>File (size)</th>
           <th>Actions</th>
         </tr>
      </thead>
      <tbody>
         {% for doc in contract_documents %}
         <tr>
           <td>{{ doc.reference }}</td>
           <td>{{ doc.contract_date.strftime('%d-%b-%Y')}}</td>
           <td>
            {{ doc.created_by.full_name }}<br>
            {{ doc.created_datetime.strftime('%d-%b-%Y %H:%M')}}
          </td>
          <td><a href="{{ icms_url('import:wood:view-contract-document', kwargs={'application_pk': process.pk, 'document_pk': doc.pk}) }}">
           {{ doc.filename }}</a> {{ doc.human_readable_file_size() }}
          </td>
           <td>
             <form method="post"
                 action="{{ icms_url('import:wood:delete-contract-document', kwargs={'application_pk': process.pk, 'document_pk': doc.pk}) }}">
               {{ csrf_input }}
               <button type="submit" class="link-button icon-bin button">Delete</button>

              </form>

              <p>
                <a href="{{ icms_url('import:wood:edit-contract-document', kwargs={'application_pk': process.pk, 'document_pk': doc.pk}) }}"
                   class="link-button icon-pencil button">
                  Edit</a>
              </p>
           </form>
        </td>
         </tr>
         {% endfor %}
      </tbody>
     </table>
   {% else %}
     <div class="info-box info-box-info">
       There are no contract/pre-contract documents attached
     </div>
   {% endif %}

   <a class="button small-button" href="{{ icms_url('import:wood:add-contract-document', kwargs={'pk': process.pk}) }}">Add contract</a>

   <h4>Supporting documents</h4>
   <p class="bold">Please provide any further supporting documents regarding this application.</p>
   <p>This may include invoices, evidence of past trade, or contracts.</p>

   {% if supporting_documents %}
     <table class="setoutList">
       <thead>
         <tr>
           <th>Document type</th>
           <th>Uploaded by</th>
           <th>File (size)</th>
           <th>Actions</th>
         </tr>
      </thead>
      <tbody>
         {% for file in supporting_documents %}
         <tr>
           <td>Supporting documents</td>
           <td>
             {{ file.created_by.full_name }}<br>
             {{ file.created_datetime.strftime('%d-%b-%Y %H:%M')}}
           </td>
           <td><a href="{{ icms_url('import:wood:view-supporting-document', kwargs={'application_pk': process.pk, 'document_pk': file.pk}) }}">
           {{ file.filename }}</a> {{ file.human_readable_file_size() }}</td>
           <td>
             <form method="post"
                 action="{{ icms_url('import:wood:delete-supporting-document', kwargs={'application_pk': process.pk, 'document_pk': file.pk}) }}">
               {{ csrf_input }}
               <button type="submit" class="link-button icon-bin button">Delete</button>
              </form>
           </td>
         </tr>
         {% endfor %}
      </tbody>
     </table>
   {% else %}
     <div class="info-box info-box-info">
         There are no supporting documents attached
     </div>
   {% endif %}

   <a class="button small-button" href="{{ icms_url('import:wood:add-supporting-document', kwargs={'pk': process.pk}) }}">Add supporting document</a>

{% endblock %}
