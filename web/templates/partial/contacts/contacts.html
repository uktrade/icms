<h3>Contacts</h3>

<div id="team-members" class="tab-content big-tabs" aria-hidden="false">
  {% if not contacts %}
    <div class="info-box info-box-info">There are no contacts attached</div>
  {% else %}
    {% set object_permissions = get_model_perms(object) %}
    <table class="setoutList">
      <thead>
      <tr>
        <th>Central Contact Details</th>

        {# Iterate over the object permissions #}
        {% for (codename, name) in object_permissions %}
          <th>
            <div class="individual-input input-group">
              <div class="eleven-column-input">
                <span class="text-widget tight-field"
                      aria-describedby="hint-{{ codename }}-content">{{ codename }}</span>
                <div class="input-group-addon hint-addon" style="display: inline">
                  <div id="hint-{{ codename }}-content" role="tooltip" class="hint-content">
                    <div class="screen-reader-only">Hint text,</div>
                    {{ name }}
                  </div>
                  <div aria-describedby="hint-{{ codename }}-content" class="hint icon-info tooltipstered" tabindex="0" role="link" aria-label="Hint for item"></div>
                </div>
              </div>
            </div>
          </th>
        {% endfor %}

        {% if not read_only %}
          <th>Actions</th>
        {% endif %}
      </tr>
      </thead>
      <tbody>

      {% for user in contacts %}
        {% set user_obj_perms_checker = get_user_obj_perms(user) %}

        <tr>
          <td style="white-space: nowrap">
            <div class="container setoutForm">
              <div class="row">
                <div class="twelve columns bold"><span class="text-widget ">{{ user }}</span></div>
              </div>
              <div class="row">
                <div class="twelve columns">
                <span class="text-widget ">{{ user.email or 'email' }}
                  <br/> {{ user.organisation or 'organisation' }}
                  <br/> {{ user.department or 'department' }}
                  <br/> {{ user.job_title or 'job_title' }}
                  <br> {{ user.phone_number or 'phone_number' }}
                </span>
                </div>
              </div>
            </div>
          </td>

          {% for (codename, name) in object_permissions %}
            <td>
              <div class="individual-input">
                <div class="container" role="group" aria-labelledby="pg259">
                  {{ ("&#9989;" if user_obj_perms_checker.has_perm(codename, object) else "&#10060;")|safe }}
                </div>
              </div>
            </td>
          {% endfor %}

          {% if not read_only %}
            <td>
              <div class="row">
                <div class="twelve columns">
                  <form method="post" action="{{ icms_url('contacts:delete', kwargs={'org_type': org_type, 'org_pk': object.pk, 'contact_pk': user.pk}) }}">
                    {{ csrf_input }}
                    <button type="submit" class="button small-button icon-bin">Delete</button>
                  </form>
                </div>
              </div>
            </td>
          {% endif %}
        </tr>
      {% endfor %}

      </tbody>
    </table>

  {% endif %}
  {% if not read_only %}
    <form method="post" action="{{ icms_url('contacts:add', kwargs={'org_type': org_type, 'org_pk': object.pk}) }}">
      {{ csrf_input }}
      <div class="container setoutForm">
        <div class="row">
          <div class="four columns">
            {{ contact_form.as_p() }}
          </div>
          <div class="two columns">
            <button type="submit" class="button small-button icon-add">Add contact</button>
          </div>
          <div class="six columns"></div>
        </div>
      </div>
    </form>
  {% endif %}
</div>
