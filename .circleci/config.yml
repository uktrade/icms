version: 2
jobs:
    build:
        machine:
            image: circleci/classic:latest

        steps:
            - checkout

            - run:
                    name: build containers
                    command:  make build

            - run:
                    name: run unit tests & lint checks
                    command: make test

            - run:
                    name: run end to end tests
                    command: make behave

            - store_test_results:
               path: test-reports

            - run:
                name: Publish coverage
                command: |
                    ls -l test-reports
                    wget -O codecov.sh https://codecov.io/bash
                    bash ./codecov.sh -t ${COV_TOKEN} -v -f test-reports/cov.xml



