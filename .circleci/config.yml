version: 2
jobs:
    build:
        machine:
            image: ubuntu-1604:202004-01

        steps:
            - checkout

            - run:
                name: build containers
                command:  make build

            - run:
                name: run coding standards compliance test
                command: make flake8

            - run:
                name: run unit tests
                command: make test

            - run:
                name: run end to end tests
                command: make behave

            - store_test_results:
                path: test-reports

            - run:
                name: Publish coverage
                command: |
                    wget -O codecov.sh https://codecov.io/bash
                    bash ./codecov.sh -t ${CODECOV_TOKEN} -s test-reports



